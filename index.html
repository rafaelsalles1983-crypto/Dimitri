<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Славянский клуб</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCVt4eQOSUMhtKTUc89lAIM-AwrPakEOOI",
    authDomain: "clube-eslavo-dimitri.firebaseapp.com",
    projectId: "clube-eslavo-dimitri",
    storageBucket: "clube-eslavo-dimitri.firebasestorage.app",
    messagingSenderId: "696802076277",
    appId: "1:696802076277:web:3be4a9fb64001e25cefa3c",
    measurementId: "G-1H63WPQT0V"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
</script>

<style>
/* ===================== CSS ===================== */

/* Layout geral, header, nav */
header { position: relative; padding: 10px; background:#eee; display:flex; align-items:center; }
header #siteTitle { font-weight:bold; font-size:1.5em; }
header button, header a.btn { margin-left:10px; }

/* Modal e overlays */
.modal, .overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center; }
.modal-content, .overlay-content { background:#fff; padding:20px; border-radius:10px; max-width:900px; width:90%; position:relative; overflow-y:auto; }

/* Botão fechar */
.close, .close-btn { position:absolute; top:10px; right:15px; font-size:28px; font-weight:bold; cursor:pointer; }

/* Lições */
.lesson-container { display:grid; grid-template-columns:repeat(auto-fill, minmax(180px,1fr)); gap:10px; padding:20px; }
.lesson-card { padding:20px; background:#ddd; border-radius:8px; cursor:pointer; text-align:center; }
.lesson-card.locked { pointer-events:none; opacity:0.5; cursor:not-allowed; }

/* Mascote Dimitri */
#dimitri { position:fixed; bottom:20px; right:20px; width:120px; height:180px; z-index:1000; }
#dimitri .head { width:80px; height:80px; background:#ffcc99; border-radius:50%; margin:0 auto; position:relative; border:2px solid #333; }
.ushanka { width:100%; height:30px; background:#800000; position:absolute; top:-10px; border-radius:50% 50% 0 0; }
.ushanka .ear { width:20px; height:20px; background:#800000; position:absolute; top:10px; border-radius:50%; }
.ushanka .ear.left { left:-10px; } .ushanka .ear.right { right:-10px; }
#dimitri .eye { width:15px; height:15px; background:#000; border-radius:50%; position:absolute; top:25px; animation:blink 4s infinite; }
#dimitri .eye.left { left:18px; } #dimitri .eye.right { right:18px; }
@keyframes blink { 0%,90%,100%{height:15px;} 95%{height:2px;} }
#dimitri .eyebrow { width:18px; height:3px; background:#333; position:absolute; top:18px; }
#dimitri .eyebrow.left { left:15px; transform:rotate(-10deg); } 
#dimitri .eyebrow.right { right:15px; transform:rotate(10deg); }
#dimitri .mouth { width:40px; height:10px; border-bottom:3px solid #000; border-radius:0 0 20px 20px; position:absolute; bottom:15px; left:50%; transform:translateX(-50%); transition:all 0.3s; }
#dimitri .body { width:70px; height:80px; background:#0055aa; margin:0 auto; position:relative; top:10px; border-radius:10px; }
#dimitri .arm { width:15px; height:50px; background:#0055aa; position:absolute; top:10px; border-radius:10px; transform-origin:top center; transition:transform 0.3s; }
#dimitri .arm.left { left:-15px; } #dimitri .arm.right { right:-15px; }
.acenando .arm.left { transform:rotate(-30deg); } .acenando .arm.right { transform:rotate(30deg); }
.acenando .body { animation:pulse 0.3s infinite alternate; }
.triste .mouth { border-bottom:none; border-top:3px solid #000; border-radius:20px 20px 0 0; }
@keyframes pulse { 0%{transform:scale(1);} 100%{transform:scale(1.05);} }
.neon .body, .neon .ushanka { animation: neonPulse 0.5s infinite alternate; }
@keyframes neonPulse { 0%{background-color:#0055aa; box-shadow:none;} 50%{background-color:#0f0; box-shadow:0 0 10px #0f0,0 0 20px #0f0;} 100%{background-color:#0055aa; box-shadow:none;} }

/* Mensagem de parabéns neon */
#congratsMessage { display:none; font-size:3em; font-weight:bold; color:#0f0; text-align:center; position:fixed; top:40%; left:50%; transform:translate(-50%,-50%); z-index:2000; pointer-events:none; animation:neonBlink 1s infinite; }
@keyframes neonBlink { 0%,50%,100%{text-shadow:0 0 5px #0f0,0 0 10px #0f0,0 0 20px #0f0,0 0 40px #0f0; opacity:1;} 25%,75%{text-shadow:none; opacity:0.6;} }

/* Chat */
.chat-container { position:fixed; bottom:0; right:0; width:300px; max-height:400px; background:#fff; border:1px solid #ccc; display:flex; flex-direction:column; z-index:1500; }
.chat-messages { flex:1; overflow-y:auto; padding:10px; }
.chat-message { margin-bottom:10px; display:flex; align-items:flex-start; }
.chat-message.bot .avatar { width:25px; height:25px; background:#0f0; border-radius:50%; margin-right:5px; text-align:center; font-weight:bold; }
.chat-input-container { display:flex; padding:5px; }
.chat-input-container input { flex:1; padding:5px; }
.chat-input-container button { padding:5px 10px; }

/* Menu mobile */
nav.show { display:block; }
</style>
</head>
<body>

<header>
  <span id="siteTitle">Славянский клуб</span>
  <button id="menuToggle" class="btn">☰ Menu</button>
  <a href="#" id="logoutBtn" class="btn" style="opacity:0; transition:opacity 0.5s;">Sair</a>
  <button id="languageToggle">PT</button>
  <button id="loginBtn">Login para Chat</button>
  <span id="welcomeUser" style="position:absolute; top:15px; right:20px; color:blue; font-weight:bold; display:none;"></span>
</header>

<nav>
  <ul>
    <li><a href="#" onclick="saveChatState(); return false;">Перетаскивание</a></li>
    <li><a href="crossword.html" onclick="saveChatState()">Прогресс</a></li>
    <li><a href="exercises.html" onclick="saveChatState()">Упражнения</a></li>
    <li><a href="jogoCores.html" onclick="saveChatState()">Игра Цвета</a></li>
    <li><a href="#" onclick="saveChatState(); return false;">Кто мы</a></li>
    <li><a href="contact.html" onclick="saveChatState()">Контакт</a></li>
    <li><a href="#" onclick="abrirDicionario(); return false;">Словáрь</a></li>
  </ul>
</nav>

<div id="progress-container">
  <div id="progress-bar"></div>
</div>
<div id="overallProgress" class="progress-text">Progresso: 0 de 18 módulos concluídos</div>

<div class="lesson-container">
  <div class="lesson-card" data-key="possessivos">Притяжательные прилагательные</div>
  <div class="lesson-card locked" data-key="numerais">Числительные</div>
  <!-- restantes cards -->
</div>

<div id="dimitri">
  <div class="head">
    <div class="ushanka">
      <div class="ear left"></div>
      <div class="ear right"></div>
    </div>
    <div class="eye left"></div>
    <div class="eye right"></div>
    <div class="eyebrow left"></div>
    <div class="eyebrow right"></div>
    <div class="mouth"></div>
  </div>
  <div class="body">
    <div class="arm left"></div>
    <div class="arm right"></div>
  </div>
</div>

<div id="congratsMessage">Поздравления!</div>

<div id="chat-container" class="chat-container">
  <div id="chat-messages" class="chat-messages"></div>
  <div class="chat-input-container">
    <input type="text" id="chat-input" placeholder="Digite sua mensagem..." />
    <button id="chat-send">Enviar</button>
  </div>
</div>

<!-- Overlay para exercícios e dicionário -->
<div id="overlayModal" class="overlay">
  <div class="overlay-content">
    <span class="close-btn" onclick="closeOverlay()">&times;</span>
    <div id="overlayBody"></div>
  </div>
</div>

<!-- ===================== Scripts ===================== -->
<script>
// Idioma
const translations = {
  ru:{title:"Славянский клуб", nav:{drag:"Перетаскивание", crossword:"Прогресс", exercises:"Упражнения"} },
  pt:{title:"Clube Eslavo", nav:{drag:"Arrastar", crossword:"Progresso", exercises:"Exercícios"} }
};
let currentLang = 'ru';
document.getElementById('languageToggle').addEventListener('click', ()=>{ currentLang = currentLang==='ru'?'pt':'ru'; updateLanguage(); });
function updateLanguage(){ const lang=translations[currentLang]; document.getElementById('siteTitle').textContent=lang.title; document.getElementById('languageToggle').textContent=currentLang==='ru'?'PT':'RU'; }

// Menu mobile
document.getElementById('menuToggle').addEventListener('click', ()=>{ document.querySelector('nav').classList.toggle('show'); });

// Mascote funções
function dimitriAcena(){ dimitri.classList.add('acenando'); dimitri.classList.remove('triste'); setTimeout(()=> dimitri.classList.remove('acenando'),1200);}
function dimitriTriste(){ dimitri.classList.add('triste'); setTimeout(()=> dimitri.classList.remove('triste'),1200);}
function dimitriNeonCelebration(){ dimitri.classList.add('neon'); congratsMessage.style.display='block'; setTimeout(()=>{ dimitri.classList.remove('neon'); congratsMessage.style.display='none'; },4000); }

// Chat
function addMessage(text,sender='user'){ const container=document.getElementById('chat-messages'); const msg=document.createElement('div'); msg.className='chat-message '+sender; if(sender==='bot'){ const avatar=document.createElement('div'); avatar.className='avatar'; avatar.textContent='AI'; msg.appendChild(avatar); } const span=document.createElement('span'); span.textContent=text; msg.appendChild(span); container.appendChild(msg); container.scrollTop=container.scrollHeight; }
document.getElementById('chat-send').addEventListener('click', async ()=>{
  const text=document.getElementById('chat-input').value.trim(); if(!text) return;
  addMessage(text,'user'); document.getElementById('chat-input').value='';
  try{ const res=await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text})}); const data=await res.json(); addMessage(data.reply || 'Sem resposta do servidor.','bot'); }
  catch(err){ addMessage('🤖 Resposta automática (offline): '+text,'bot'); }
});
document.getElementById('chat-input').addEventListener('keypress',e=>{ if(e.key==='Enter') document.getElementById('chat-send').click(); });

// Login/logout
document.addEventListener('DOMContentLoaded',()=>{
  const logoutBtn=document.getElementById('logoutBtn');
  auth.onAuthStateChanged(user=>{
    if(user){ logoutBtn.style.display='inline-block'; logoutBtn.style.opacity='1'; } 
    else { logoutBtn.style.display='none'; logoutBtn.style.opacity='0'; }
  });
  logoutBtn.addEventListener('click',()=>{ auth.signOut().then(()=>{ localStorage.removeItem('redirectAfterLogin'); window.location.href='index.html'; }); });

  const chatInput=document.getElementById('chat-input'); const chatSend=document.getElementById('chat-send');
  auth.onAuthStateChanged(user=>{
    if(!user){ chatInput.disabled=true; chatInput.placeholder="🔒 Faça login para responder..."; chatSend.disabled=true; chatSend.style.opacity="0.5"; chatSend.style.cursor="not-allowed"; } 
    else{ chatInput.disabled=false; chatInput.placeholder="Digite sua mensagem..."; chatSend.disabled=false; chatSend.style.opacity="1"; chatSend.style.cursor="pointer"; }
  });
});

// Overlay
function openOverlay(url){ const overlay=document.getElementById('overlayModal'); const content=document.getElementById('overlayBody'); fetch(url).then(r=>r.text()).then(html=>{content.innerHTML=html; overlay.style.display='flex';}).catch(err=>console.error(err)); }
function closeOverlay(){ document.getElementById('overlayModal').style.display='none'; document.getElementById('overlayBody').innerHTML=''; }
function abrirDicionario(){ const overlay=document.getElementById('overlayModal'); const content=document.getElementById('overlayBody'); content.innerHTML=`<button onclick="fecharDicionario()" style="position:absolute; top:10px; right:10px;">Fechar</button><h2>Словáрь — Dicionário Russo-Português</h2>`; overlay.style.display='flex'; }
function fecharDicionario(){ document.getElementById('overlayModal').style.display='none'; }

// Login button
document.getElementById('loginBtn').addEventListener('click',()=>{ const user=auth.currentUser; if(!user){ localStorage.setItem('redirectAfterLogin','index.html'); window.location.href='login.html'; } else{ alert('Você já está logado!'); } });

// Desbloqueio lições
function unlockNextModule(currentKey){ const cards=document.querySelectorAll('.lesson-card'); for(let i=0;i<cards.length;i++){ if(cards[i].dataset.key===currentKey && i<cards.length-1){ cards[i+1].classList.remove('locked'); break; } } }
</script>

</body>
</html>
